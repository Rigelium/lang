<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:type" content="website">
<meta property="og:title" content="Deicto">
<meta property="og:description" content="A silly language learning game made by an even sillier student">
<meta property="og:image" content="https://rigelium.github.io/deicto/assets/logo.png">

     
    <link rel="icon" type="image/x-icon" href="https://cdn.discordapp.com/attachments/638813266440880140/1452871487945048154/image.png?ex=694b6383&is=694a1203&hm=ea28a03cd258d23b8acf516ce5d50e8d8c18830545825d3c39ad702c7ab846fc">
    <link rel="stylesheet" href="../assets/styles.css">
    <title>Deicto</title>
   <style>
     #btn-container a{
       text-decoration: none;
       color: var(--fontcolor2);  
     }
     #btn-container a:hover{
       color: var(--highlight);  
     }
     .blank-button{
       background: var(--blankcolor); 
       border-radius: 2px; 
       margin: 0 2 0 2;
       padding: 1 2 1 2;
     }
     .answer{
       border-radius: 5px;
       background-color: var(--boxcolor1);
       padding: 10px;
       height: 50px;
     }
     #dictionary-container a {
       display: block;
       white-space: pre-wrap; 
       text-decoration: none;
       color: var(--text-white);
     }
   </style>
  </head>
<body>
  <div style="display: flex; flex-direction: column; justify-content: center; gap: 15px;">
    <div class="box1" style="display: flex; flex-direction: column; gap: 3px;">
      <div id="btn-container" style="display: flex; gap: 4px; flex-wrap: wrap; justify-content: center;"></div>
      <a id="notes-desc"></a>
      <a id="translated" style="color: var(--fontcolor3); text-align: center;"></a>
    </div>
    <div id=dictionary-container></div>
    <div id="notes-container"></div>
    <div id="answer-container" style="display: flex; flex-direction: column; gap: 10px;"></div>
    <div id="cont-container"></div>
  </div>
  <script>

    window.onload = loadLevelData;

    
    let currentSentence = 0;

    // USER SETTINGS
    
    // COURSE SETTINGS
    let language = retrieveVariable("language", "Hungarian");
    let langCodeTTS = retrieveVariable("langCodeTTS", "HU-hu");
    let difLevel = retrieveVariable("difLevel", "advanced");
    // LEVEL SETTING
    let currentLevel = retrieveVariable("currentLevel", "1"); 

    // LEVEL DATA LOADING --------------------------------------------------------------------------------
    let levelData, sentencesHu, lvTitle, notes = null;
    async function loadLevelData() {
      try {
        const response = await fetch("../levels/" + language.toLowerCase() + "/" + difLevel + "/lv_" + currentLevel + ".json");
        levelData = await response.json();        
        lvTitle = levelData.title;
        sentencesHu = levelData.sentences;  
        notes = levelData.dictionary;
        if (currentSentence == 0){
          displayNotes();
        } else {
          generateSentence();
        }
      } catch (error) {
        console.error("Failed to load level data.", error);
      }
    }

    //////////////////////////////////////////////////////////////////////////////notes/////////////////////////////////////////////////////////////////////////////////////////
    function displayNotes() {
      const notesContainer = document.getElementById('notes-container');
      const dictionaryContainer = document.getElementById('dictionary-container');
      
      const notesBox = document.createElement('div');
      const notesContinue = document.createElement('div');
      const notesText = document.createElement('a');
      const notesContinueText = document.createElement('a');

      document.getElementById('notes-desc').textContent = "Notes for the following level: " + "Level " + currentLevel + " - " + lvTitle + " [" + language + ", " + difLevel;
    
      notesBox.className = "box1";
      notesContinue.className = "box1";
      notesContinue.style.backgroundColor = "var(--blueish)";
      notesText.textContent = notes;
      notesContinueText.textContent = "Continue";
      
      notesContinue.addEventListener('click', () => {
        notesContainer.replaceChildren();
        dictionaryContainer.replaceChildren();
        document.getElementById('notes-desc').innerHTML = "";
        generateSentence();
      });

      notesContinue.appendChild(notesContinueText);
      notesBox.appendChild(notesText);
      notesContainer.appendChild(notesContinue);
      dictionaryContainer.appendChild(notesBox);
    }


    //=======================================================================================================================================================
    
    function generateSentence() {
      
      // GENERATING SENTENCE 
      container = document.getElementById("btn-container");

      for(let i = 0; i<sentencesHu[currentSentence][0].split(" ").length ; i++){
        const btn = document.createElement('a');
        btn.textContent = sentencesHu[currentSentence][0].split(" ")[i];
        btn.href = "https://en.wiktionary.org/wiki/" + btn.innerText.replace(/[.,?!]/g, "") + "#" + language;
        container.appendChild(btn); 
      }
      
      const btn = document.createElement('a');
        btn.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
        btn.className = "blank-button";
        btn.id = "hidden";
        container.appendChild(btn);
      
      for(let i = 0; i<sentencesHu[currentSentence][2].split(" ").length ; i++){
        const btn = document.createElement('a');
        btn.textContent = sentencesHu[currentSentence][2].split(" ")[i];
        btn.href = "https://en.wiktionary.org/wiki/" + btn.innerText.replace(/[.,?!]/g, "") + "#" + language;
        container.appendChild(btn);
      }

      //GENERATE THE TRANSLATION
      const translated = document.getElementById('translated');
      translated.textContent = sentencesHu[currentSentence][3];
    

    //GENERATE THE ANSWERS 4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    const answerContainer = document.getElementById("answer-container");
    const answer = [];
    const answerText = [];
    let answerGiven = 0;
    for(let i = 0; i < 4; i++){
      answer[i] = document.createElement('div');
      answer[i].className = "answer";
      
      answerText[i] = document.createElement('a');
      answerText[i].textContent = sentencesHu[currentSentence][i+4];

      answer[i].addEventListener('click', () =>{
        if(answerGiven == 0){
        const rightAnswer = document.getElementById('hidden');
        rightAnswer.textContent = sentencesHu[currentSentence][1];
        rightAnswer.style.backgroundColor = 'var(--boxcolor1)';
        rightAnswer.style.color = 'var(--blueish)';
        rightAnswer.href = "https://en.wiktionary.org/wiki/" + sentencesHu[currentSentence][1] + "#" + language;

          //SENTENCE ANSWERED
          playText(sentencesHu[currentSentence][0] + sentencesHu[currentSentence][1] + sentencesHu[currentSentence][2], langCodeTTS);
        showContinue();
        if (answerText[i].textContent==sentencesHu[currentSentence][1]){
          //CORRECT CHOICE
          answer[i].style.backgroundColor = "var(--blueish)";
        }else{
          answer[i].style.backgroundColor = "red";
        }
        answerGiven = 1;
        }
      });
      
      answerContainer.appendChild(answer[i]);
      answer[i].appendChild(answerText[i]);
    }
    
    //GENERATE THE CONTINUE BUTTON
    function showContinue(){
      contContainer = document.getElementById('cont-container');
      const cont = document.createElement('div');
      cont.className="box1";

      const repeatTTS = document.createElement('div');
      repeatTTS.className="box1";
      repeatTTS.addEventListener('click', ()=>{
        playText(sentencesHu[currentSentence][0] + sentencesHu[currentSentence][1] + sentencesHu[currentSentence][2], langCodeTTS);
      });
      repeatTTS.style.backgroundColor="var(--highlight)";
      repeatTTS.style.width = "30%";
      
      //cont.style.backgroundColor="var(--grayish)";

      const nextSent = document.createElement('div');
      nextSent.className="box1";
      nextSent.style.backgroundColor="var(--highlight)";
      nextSent.style.width = "30%";

      const nextSentText = document.createElement('a');
      nextSentText.textContent = "Continue";
      
      
      nextSent.addEventListener("click", () => {
        currentSentence++;
        contContainer.replaceChildren();
        container.replaceChildren();
        answerContainer.replaceChildren();
        generateSentence();
      });

      contContainer.appendChild(cont);
        cont.appendChild(nextSent);
          nextSent.appendChild(nextSentText);
        cont.appendChild(repeatTTS);      
      
      }
    }
    //////////////////////////////////////////////////////////////TSS HERE
    /*function playText(text, langCode) {
    // 1. Create a "shout" object
    const utterance = new SpeechSynthesisUtterance(text);
    
    // 2. Set the language (e.g., 'hu-HU', 'pl-PL', 'de-DE')
    utterance.lang = langCode;
    
    // 3. Optional: Adjust pitch and rate for better clarity
    utterance.rate = 1.0; // Slightly slower than normal for learners
    utterance.pitch = 1.0;

    // 4. Speak!
    window.speechSynthesis.speak(utterance);
    }*/

    function playText(text, langCode) {
    const utterance = new SpeechSynthesisUtterance(text);
    
    // Get all available voices on this specific device
    const voices = window.speechSynthesis.getVoices();

    // Find a voice that matches your requested language (e.g., 'hu-HU')
    const selectedVoice = voices.find(voice => voice.lang.includes(langCode));

    if (selectedVoice) {
        utterance.voice = selectedVoice;
        utterance.lang = selectedVoice.lang; // Sync them up
    } else {
        console.warn(`No voice found for ${langCode}. Falling back to default.`);
        utterance.lang = langCode; // Fallback attempt
    }

    window.speechSynthesis.speak(utterance);
}

    
    /////////////////////////////////////////////////////////////////////////////////////RETRIEVE DATA
    function retrieveVariable(varName, defaultValue) {
        try {
          const storedValue = localStorage.getItem(varName);
          if (storedValue == null){
            return defaultValue;
          }
          return storedValue;
        } catch(error) {
          console.error(error);
          return defaultValue;
        }
      }
  </script>
</body>
</html>
